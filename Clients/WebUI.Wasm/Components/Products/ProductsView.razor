@rendermode InteractiveServer

@using Microsoft.AspNetCore.Components.Web
@using SharedModels.Products
@using WebUI_Wasm.Services
@using static WebUI_Wasm.Services.HttpService

@inject NavigationManager nav
@inject IHttpClientFactory ClientFactory

<h3>ProductView</h3>

@if (categories == null)
{
    <p><em>Loading...</em></p>
    <button @onclick="GetData">get categories</button>
}
else
{
    foreach (var item in categories)
    {
        <h4>@item.Name:</h4>
        <ul>
            @foreach (var product in item.Products)
            {
                var link = $"/Product/{product.Id}/{product.Name}";
                <li><NavLink href="@link">@product.Name</NavLink></li>
            }
        </ul>
    }
}

@code {
    [Inject]
    public HttpService HttpService { get; set; }

    IList<Category> categories;

    protected override async Task OnInitializedAsync()
    {
        var client = ClientFactory.CreateClient("ApiClient");
        await GetData();
    }
    private async Task GetData()
    {
        try
        {
            var response = await HttpService.HttpClient(ServicesUrl.ProductsAPI).GetAsync("/products/Categories/getcategorieslink", System.Threading.CancellationToken.None);
            if (response != null && response.IsSuccessStatusCode == true)
                categories = await response.Content.ReadFromJsonAsync<IList<Category>>();
        }
        catch (Exception ex)
        {
            Console.WriteLine(ex.Message);
        }
    }
}
